<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="style.css">   
    </head>
<body>

      <header class="mdc-top-app-bar">
        <div class="mdc-top-app-bar__row">
          <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
            <button class="material-icons mdc-top-app-bar__navigation-icon mdc-icon-button arrow-back" aria-label="Close"><a href="index.html">arrow_back</a></button>          
            <span class="mdc-top-app-bar__title">Add Task</span>
          </section>
          <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end" role="toolbar">
            <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="add" onclick="window.location.href='add.html'">add</button>
            <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Search">search</button>

            <div id="todo-menu-container" class="mdc-menu-surface--anchor">
                <button id="todo-menu-button" class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Options">more_vert</button>

                <div class="mdc-menu mdc-menu-surface">
                    <ul class="mdc-list" role="menu" aria-hidden="true" aria-orientation="vertical" tabindex="-1">
                        <li class="mdc-list-item" role="menuitem">
                          <span class="mdc-list-item__ripple"></span>
                          <span class="mdc-list-item__text"><a href="index.html">Home</a></span>
                        </li>                      
                        <li class="mdc-list-item" role="menuitem">
                          <span class="mdc-list-item__ripple"></span>
                          <span class="mdc-list-item__text"><a href="add.html">Add Item</a></span>
                        </li>
                        <li class="mdc-list-item" role="menuitem">
                          <span class="mdc-list-item__ripple"></span>
                          <span class="mdc-list-item__text"><a href="help.html">Help</a></span>
                        </li>
                    </ul>
                </div>
            </div>
          </section>
        </div>
      </header>

      <main class="mdc-top-app-bar--fixed-adjust">

        <form id="todo-add-form">

          <div class="mdc-form-field">
            
            <label class="todo-title mdc-text-field mdc-text-field--filled">
              <span class="mdc-text-field__ripple"></span>
              <span class="mdc-floating-label" id="task-title-text">Title</span>
              <input id="task-title" class="mdc-text-field__input" type="text" aria-labelledby="task-title-text">
              <span class="mdc-line-ripple"></span>
            </label>

          </div>                    

          <div class="mdc-form-field">
            <label class="todo-description mdc-text-field mdc-text-field--filled">
              <span class="mdc-text-field__ripple"></span>
              <span class="mdc-floating-label" id="task-description-text">Description</span>
              <input id="task-description" class="mdc-text-field__input" type="text" aria-labelledby="task-description-text">
              <span class="mdc-line-ripple"></span>
            </label>
          </div>

          <div class="mdc-form-field">
            <button class="mdc-button mdc-button--raised foo-button">
              <div class="mdc-button__ripple"></div>
              <span class="mdc-button__label">Button</span>
            </button>                
          </div>

        </form>

        <form id="myForm" action="/action_page.php">
          Title: <input id="todo-title" type="text" name="fname">
          Description: <textarea textarea id="todo-description" name="w3review" rows="4" cols="50"></textarea>
          <input type="submit" value="Submit">
        </form>

      </main>
      
    

    <button class="mdc-button foo-button">
      <div class="mdc-button__ripple"></div>
      <span class="mdc-button__label">Button</span>
    </button>

      <button id="askButton">Ask for location</button>

      <div id="target"></div>      
      <div id="note"></div>      

</body>

<script>

const request = indexedDB.open("TodoList",5);
let db;

request.onupgradeneeded = function() {
  // The database did not previously exist, so create object stores and indexes.
  const db = request.result;
  const store = db.createObjectStore("tasks", {keyPath: "id", autoIncrement:true});

  // Populate with initial data.
  store.put({title: "Task 1", description: "Description of task 1"});
  store.put({title: "Task 2", description: "Another description in the app"});
  store.put({title: "Task 3", description: "Just another description in the app"});
};

request.onsuccess = function() {
  db = request.result;
  
};

const note = document.getElementById("note");

// Let us open our database
var DBOpenRequest = indexedDB.open("TodoList",5);

DBOpenRequest.onsuccess = function(event) {
  note.innerHTML += '<li>Database initialized.</li>';

  // store the result of opening the database in the db variable.
  // This is used a lot below
  db = DBOpenRequest.result;

  // Run the getData() function to get the data from the database
  getData();
  printData();
};

function printData(){
  var objectStore = db.transaction("tasks").objectStore("tasks");

  objectStore.openCursor().onsuccess = event => {
    var cursor = event.target.result;
    if (cursor) {
      console.log("Data " + cursor.key + " is " + cursor.value.title);
      cursor.continue();
    }
    else {
      console.log("No more entries!");
    }
  };  
}

function deleteData(){
  // open a read/write db transaction, ready for retrieving the data
  var transaction = db.transaction(["tasks"], "readwrite");
  
  let request = transaction.objectStore("tasks").delete(1);

  // report that the data item has been deleted
  transaction.oncomplete = function() {
    // delete the parent of the button, which is the list item, so it no longer is displayed
    console.log("Deleted");
  }; 

}

function getData() {
  // open a read/write db transaction, ready for retrieving the data
  var transaction = db.transaction(["tasks"], "readwrite");

  // report on the success of the transaction completing, when everything is done
  transaction.oncomplete = function(event) {
    note.innerHTML += '<li>Transaction completed.</li>';
  };

  transaction.onerror = function(event) {
    note.innerHTML += '<li>Transaction not opened due to error: ' + transaction.error + '</li>';
  };

  // create an object store on the transaction
  var objectStore = transaction.objectStore("tasks");

  // Make a request to get a record by key from the object store
  var objectStoreRequest = objectStore.get(1);

  objectStoreRequest.onsuccess = function(event) {
    // report the success of our request
    note.innerHTML += '<li>Request successful.</li>';

    var myRecord = objectStoreRequest.result;
    console.log("I am here");
    console.log(myRecord);
  };

};


mdc.textField.MDCTextField.attachTo(document.querySelector('.todo-description'))
mdc.textField.MDCTextField.attachTo(document.querySelector('.todo-title'))

mdc.ripple.MDCRipple.attachTo(document.querySelector('.foo-button'));

//use the mdc keyword to find things look the following
/*this was one the website and the uncommented code works
const menu = new MDCMenu(document.querySelector('.mdc-menu'));
menu.open = true;
*/
const menu = mdc.menu.MDCMenu.attachTo(document.querySelector(".mdc-menu"));
//menu.open = true;
menu.setAbsolutePosition(100, 100);

const menu_button = document.getElementById("todo-menu-button");

menu_button.addEventListener("click",function(event){
    event.preventDefault();
    menu.open=true;
});



document.getElementById("myForm").addEventListener("submit",function(e){
  e.preventDefault();

  const todo_title       = document.getElementById("todo-title").value;
  const todo_description = document.getElementById("todo-description").value;

  var transaction = db.transaction(["tasks"], "readwrite");
  var objectStore = transaction.objectStore("tasks");

  var request = objectStore.add({title: todo_title, description: todo_description});
  request.onsuccess = event => {
    // event.target.result === customer.ssn;
    document.getElementById("todo-title").value="";
    document.getElementById("todo-description").value="";
  };

});

document.getElementById("todo-add-form").addEventListener("submit",function(e){
  e.preventDefault();

  const todo_title       = document.getElementById("task-title").value;
  const todo_description = document.getElementById("task-description").value;

  var transaction = db.transaction(["tasks"], "readwrite");
  var objectStore = transaction.objectStore("tasks");

  var request = objectStore.add({title: todo_title, description: todo_description});
  request.onsuccess = event => {
    // event.target.result === customer.ssn;
    document.getElementById("task-title").value="";
    document.getElementById("task-description").value="";
  };

});

</script>
</html>  