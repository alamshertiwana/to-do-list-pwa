<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <style>
      body {
          margin: 0px;
      }

      .mdc-menu-surface--open {
          width: 150px;
      }

      .mdc-list-item__text a,li.mdc-list-item a{
          text-decoration: none;
          color:inherit;
      }

      #todo-menu-container span.mdc-list-item__text {
          width: 100%;
      }

      #todo-menu-container .mdc-list-item__text a {
          width: 100%;
          display: block;
      }
    </style>    
    </head>
<body>

    <header class="mdc-top-app-bar">
        <div class="mdc-top-app-bar__row">
          <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
            <span class="mdc-top-app-bar__title">TODO List</span>
          </section>
          <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end" role="toolbar">
            <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="add" onclick="window.location.href='add.html'">add</button>
            <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Search">search</button>

            <div id="todo-menu-container" class="mdc-menu-surface--anchor">
                <button id="todo-menu-button" class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Options">more_vert</button>

                <div class="mdc-menu mdc-menu-surface">
                    <ul class="mdc-list" role="menu" aria-hidden="true" aria-orientation="vertical" tabindex="-1">
                        <li class="mdc-list-item" role="menuitem">
                          <span class="mdc-list-item__ripple"></span>
                          <span class="mdc-list-item__text"><a href="index.html">Home</a></span>
                        </li>                      
                        <li class="mdc-list-item" role="menuitem">
                          <span class="mdc-list-item__ripple"></span>
                          <span class="mdc-list-item__text"><a href="add.html">Add Item</a></span>
                        </li>
                        <li class="mdc-list-item" role="menuitem">
                          <span class="mdc-list-item__ripple"></span>
                          <span class="mdc-list-item__text">Help</span>
                        </li>
                    </ul>
                </div>
            </div>

          </section>
        </div>
      </header>
      <main class="mdc-top-app-bar--fixed-adjust">

        <ul class="mdc-list" id="todo-list">
          <!--
            <li class="mdc-list-item" tabindex="0">
              <span class="mdc-list-item__ripple"></span>
              <span class="mdc-list-item__text">Single-line item</span>
            </li>
            <li class="mdc-list-item">
              <span class="mdc-list-item__ripple"></span>
              <span class="mdc-list-item__text">Single-line item</span>
            </li>
            <li class="mdc-list-item">
              <span class="mdc-list-item__ripple"></span>
              <span class="mdc-list-item__text">Single-line item</span>
            </li>
            <li class="mdc-list-item" tabindex="0">
                <span class="mdc-list-item__ripple"></span>
                <span class="mdc-list-item__text">Single-line item</span>
            </li>                                                                               
          </ul>
          -->

      </main>
      
    

    <button class="mdc-button foo-button">
        <div class="mdc-button__ripple"></div>
        <span class="mdc-button__label">Button</span>
      </button>

      <button id="askButton">Ask for location</button>

      <div id="target"></div>      
      <div id="note"></div>      

</body>

<script>

const todo_list = document.getElementById("todo-list");


const request = indexedDB.open("TodoList",5);
let db;

request.onupgradeneeded = function() {
  // The database did not previously exist, so create object stores and indexes.
  const db = request.result;
  const store = db.createObjectStore("tasks", {keyPath: "id", autoIncrement:true});

  // Populate with initial data.
  store.put({title: "Task 1", description: "Description of task 1"});
  store.put({title: "Task 2", description: "Another description in the app"});
  store.put({title: "Task 3", description: "Just another description in the app"});
  store.put({title: "Quarry Memories", author: "Fred", isbn: 123456});
};

request.onsuccess = function() {
  db = request.result;
};

const note = document.getElementById("note");

// Let us open our database
var DBOpenRequest = indexedDB.open("TodoList",5);

DBOpenRequest.onsuccess = function(event) {
  note.innerHTML += '<li>Database initialized.</li>';

  // store the result of opening the database in the db variable.
  // This is used a lot below
  db = DBOpenRequest.result;

  // Run the getData() function to get the data from the database
  getData();
  printData();
};

function list_item_click(id){
  window.location.href = 'detail.html?id='+id;
}

function printData(){
  var objectStore = db.transaction("tasks").objectStore("tasks");

  objectStore.openCursor().onsuccess = event => {
    var cursor = event.target.result;
    if (cursor) {
      console.log("Data " + cursor.key + " is " + cursor.value.title);

      todo_list.innerHTML = todo_list.innerHTML+ '<li class="mdc-list-item" tabindex="0" onclick=" list_item_click('+cursor.value.id+') " ><a href="detail.html?id='+cursor.value.id+'"> <span class="mdc-list-item__ripple"></span><span class="mdc-list-item__text">'+cursor.value.title+'</span> </a> </li> '

      cursor.continue();
    }
    else {
      console.log("No more entries!");
    }
  };  
}

function deleteData(){
  // open a read/write db transaction, ready for retrieving the data
  var transaction = db.transaction(["tasks"], "readwrite");
  
  let request = transaction.objectStore("tasks").delete(1);

  // report that the data item has been deleted
  transaction.oncomplete = function() {
    console.log("Deleted");
  }; 

}

function getData() {
  // open a read/write db transaction, ready for retrieving the data
  var transaction = db.transaction(["tasks"], "readwrite");

  // report on the success of the transaction completing, when everything is done
  transaction.oncomplete = function(event) {
    note.innerHTML += '<li>Transaction completed.</li>';
  };

  transaction.onerror = function(event) {
    note.innerHTML += '<li>Transaction not opened due to error: ' + transaction.error + '</li>';
  };

  // create an object store on the transaction
  var objectStore = transaction.objectStore("tasks");

  // Make a request to get a record by key from the object store
  var objectStoreRequest = objectStore.get(1);

  objectStoreRequest.onsuccess = function(event) {
    // report the success of our request
    note.innerHTML += '<li>Request successful.</li>';

    var myRecord = objectStoreRequest.result;
    console.log("I am here");
    console.log(myRecord);
  };

};

    /* Code for the database

const request = indexedDB.open("TodoList");
let db;

request.onupgradeneeded = function() {
  // The database did not previously exist, so create object stores and indexes.
  const db = request.result;
  const store = db.createObjectStore("tasks", {keyPath: "id", autoIncrement:true});

  // Populate with initial data.
  store.put({title: "Quarry Memories", author: "Fred"});
  store.put({title: "Water Buffaloes", author: "Fred"});
  store.put({title: "Bedrock Nights", author: "Barney"});
};

request.onsuccess = function() {
  db = request.result;
};    

    */

mdc.ripple.MDCRipple.attachTo(document.querySelector('.foo-button'));

//use the mdc keyword to find things look the following
/*this was one the website and the uncommented code works
const menu = new MDCMenu(document.querySelector('.mdc-menu'));
menu.open = true;
*/
const menu = mdc.menu.MDCMenu.attachTo(document.querySelector(".mdc-menu"));
//menu.open = true;
menu.setAbsolutePosition(100, 100);

const menu_button = document.getElementById("todo-menu-button");

menu_button.addEventListener("click",function(event){
    event.preventDefault();
    menu.open=true;
});



var target = document.getElementById('target');
var watchId;

function appendLocation(location, verb) {
  verb = verb || 'updated';
  var newLocation = document.createElement('p');
  newLocation.innerHTML = 'Location ' + verb + ': ' + location.coords.latitude + ', ' + location.coords.longitude + '';
  target.appendChild(newLocation);
}

if ('geolocation' in navigator) {
  document.getElementById('askButton').addEventListener('click', function () {
    navigator.geolocation.getCurrentPosition(function (location) {
      appendLocation(location, 'fetched');
    });
    watchId = navigator.geolocation.watchPosition(appendLocation);
  });
} else {
  target.innerText = 'Geolocation API not supported.';
}
</script>
</html>  