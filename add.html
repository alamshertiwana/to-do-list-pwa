<!DOCTYPE html>
<html>
<head>
  <title>Todo App</title>
  <meta name="description" content="This is a ToDo List app. You can managed a list of tasks.">    
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#6200ee"/>
  <link href="material-components-web.min.css" rel="stylesheet">
  <script src="material-components-web.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon-apple.jpg">      
</head>
<body>

  <header class="mdc-top-app-bar">
    <div class="mdc-top-app-bar__row">
      <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
        <button class="material-icons mdc-top-app-bar__navigation-icon mdc-icon-button arrow-back" aria-label="Close"><a href="index.html">arrow_back</a></button>          
        <span class="mdc-top-app-bar__title">Add Task</span>
      </section>
      <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end" role="toolbar">
        <button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="add" onclick="window.location.href='add.html'">add</button>

        <div id="todo-menu-container" class="mdc-menu-surface--anchor">
            <button id="todo-menu-button" class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Options">more_vert</button>

            <div class="mdc-menu mdc-menu-surface">
                <ul class="mdc-list" role="menu" aria-hidden="true" aria-orientation="vertical" tabindex="-1">
                    <li class="mdc-list-item" role="menuitem">
                      <span class="mdc-list-item__ripple"></span>
                      <span class="mdc-list-item__text"><a href="index.html">Home</a></span>
                    </li>                      
                    <li class="mdc-list-item" role="menuitem">
                      <span class="mdc-list-item__ripple"></span>
                      <span class="mdc-list-item__text"><a href="add.html">Add Item</a></span>
                    </li>
                    <li class="mdc-list-item" role="menuitem">
                      <span class="mdc-list-item__ripple"></span>
                      <span class="mdc-list-item__text"><a href="help.html">Help</a></span>
                    </li>
                </ul>
            </div>
        </div>
      </section>
    </div>
  </header>

      <main class="mdc-top-app-bar--fixed-adjust">

        <form id="todo-add-form">

          <div class="mdc-form-field">

            <label class="todo-title mdc-text-field mdc-text-field--filled">
              <span class="mdc-text-field__ripple"></span>
              <span class="mdc-floating-label" id="task-title-text">Title</span>
              <input id="task-title" class="mdc-text-field__input" type="text" aria-labelledby="task-title-text" autocomplete="off" required>
              <span class="mdc-line-ripple"></span>
            </label>

          </div>                    

          <div class="mdc-form-field">
            <label class="todo-description mdc-text-field mdc-text-field--filled">
              <span class="mdc-text-field__ripple"></span>
              <span class="mdc-floating-label" id="task-description-text">Description</span>
              <input id="task-description" class="mdc-text-field__input" type="text" aria-labelledby="task-description-text" autocomplete="off" required>
              <span class="mdc-line-ripple"></span>
            </label>
          </div>

          <p class="form-field-title">Priority</p>
          <div class="mdc-form-field">

            <div class="mdc-radio">
            <input class="mdc-radio__native-control" type="radio" id="radio-1" name="priority" value="low" checked>
            <div class="mdc-radio__background">
            <div class="mdc-radio__outer-circle"></div>
            <div class="mdc-radio__inner-circle"></div>
            </div>
            <div class="mdc-radio__ripple"></div>
            </div>
            <label for="radio-1">Low</label>

            <div class="mdc-radio">
              <input class="mdc-radio__native-control" type="radio" id="radio-2" name="priority" value="medium">
              <div class="mdc-radio__background">
              <div class="mdc-radio__outer-circle"></div>
              <div class="mdc-radio__inner-circle"></div>
              </div>
              <div class="mdc-radio__ripple"></div>
            </div>
            <label for="radio-1">Medium</label>

            <div class="mdc-radio">
              <input class="mdc-radio__native-control" type="radio" id="radio-3" name="priority" value="high">
              <div class="mdc-radio__background">
              <div class="mdc-radio__outer-circle"></div>
              <div class="mdc-radio__inner-circle"></div>
              </div>
              <div class="mdc-radio__ripple"></div>
            </div>
            <label for="radio-1">High</label>            

          </div>

          <p class="form-field-title">Save Geolocation</p>
          <div class="mdc-form-field">

            <div class="mdc-radio">
            <input class="mdc-radio__native-control" type="radio" id="geo-1" name="geolocation" value="0" checked>
            <div class="mdc-radio__background">
            <div class="mdc-radio__outer-circle"></div>
            <div class="mdc-radio__inner-circle"></div>
            </div>
            <div class="mdc-radio__ripple"></div>
            </div>
            <label for="radio-1">No</label>

            <div class="mdc-radio">
              <input class="mdc-radio__native-control" type="radio" id="geo-2" name="geolocation" value="1">
              <div class="mdc-radio__background">
              <div class="mdc-radio__outer-circle"></div>
              <div class="mdc-radio__inner-circle"></div>
              </div>
              <div class="mdc-radio__ripple"></div>
            </div>
            <label for="radio-1">Yes</label>            

          </div>          
          
          <p class="form-field-title">Highlight Task</p>
          <div class="mdc-form-field">

            <div class="mdc-checkbox">
              <input type="checkbox"
                     class="mdc-checkbox__native-control"
                     id="todo-highlight"/>
              <div class="mdc-checkbox__background">
                <svg class="mdc-checkbox__checkmark"
                     viewBox="0 0 24 24">
                  <path class="mdc-checkbox__checkmark-path"
                        fill="none"
                        d="M1.73,12.91 8.1,19.28 22.79,4.59"/>
                </svg>
                <div class="mdc-checkbox__mixedmark"></div>
              </div>
              <div class="mdc-checkbox__ripple"></div>
            </div>
            <label for="checkbox-1">Yes</label>

          </div>      

          <div class="mdc-form-field">
            <button class="mdc-button mdc-button--raised foo-button">
              <div class="mdc-button__ripple"></div>
              <span class="mdc-button__label">Button</span>
            </button>                
          </div>

        </form>

      </main>

</body>

<script>

//code for page specific material elements
mdc.textField.MDCTextField.attachTo(document.querySelector('.todo-description'));
mdc.textField.MDCTextField.attachTo(document.querySelector('.todo-title'));
mdc.ripple.MDCRipple.attachTo(document.querySelector('.foo-button'));

//Geo Coordinates
let lat;
let lon;
//code for indexeddb
const request = indexedDB.open("TodoList",5);
let db;

request.onsuccess = function() {
  db = request.result;  
};

const checkbox = mdc.checkbox.MDCCheckbox.attachTo(document.querySelector('.mdc-checkbox'));

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position){
      lat = position.coords.latitude; 
      lon = position.coords.longitude;
    }, function(error){
      document.getElementById("geo-2").disabled = true;
      switch(error.code) {
        case error.PERMISSION_DENIED:
          alert("Please make sure that the Location is turned on for the device.");
          break;
        case error.POSITION_UNAVAILABLE:
          alert("Location information is unavailable.");
          break;
        case error.TIMEOUT:
          alert("The request to get user location timed out.");
          break;
        case error.UNKNOWN_ERROR:
          alert("An unknown error occurred related to location.");
          break;
      }      
    });
  }

//Submit the form on the page
document.getElementById("todo-add-form").addEventListener("submit",function(e){
  e.preventDefault();

  const todo_title        = document.getElementById("task-title").value;
  const todo_description  = document.getElementById("task-description").value;
  const todo_priority     = document.querySelector('input[name="priority"]:checked').value;
  const todo_geolocation  = document.querySelector('input[name="geolocation"]:checked').value;
  const todo_highlight    = checkbox.checked;
  let curr_geo_location   = null;

  if(todo_geolocation == 1){
    curr_geo_location =[lat,lon];
  }

  var transaction = db.transaction(["tasks"], "readwrite");
  var objectStore = transaction.objectStore("tasks");

  var request = objectStore.add({title: todo_title, description: todo_description, priority: todo_priority, highlight: todo_highlight, geo_location: curr_geo_location});

  request.onsuccess = event => {
    document.getElementById("task-title").value="";
    document.getElementById("task-description").value="";
    window.location.href='index.html'
  };

});

//Code for global material elements
const menu = mdc.menu.MDCMenu.attachTo(document.querySelector(".mdc-menu"));
menu.setAbsolutePosition(100, 100);

const menu_button = document.getElementById("todo-menu-button");

menu_button.addEventListener("click",function(event){
    event.preventDefault();
    menu.open=true;
});

</script>
</html>  